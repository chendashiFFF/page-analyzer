# Page Analyzer

Page Analyzer 是一个浏览器扩展，结合了页面内容洞察与 AI 自动化能力。它提供弹出式界面来检测表单、生成测试数据、分析当前页面，并缓存历史结果，适用于 Chrome/Chromium 与 Firefox 在开发者模式下的临时加载。

## 功能特性
- 表单助手：检测当前标签页中的输入字段，并请求 AI 生成结构化测试数据回填
- 页面快照：提取标题、描述、正文、标题层级与链接等关键信息，形成可读摘要
- AI 分析：调用自定义或预设的对话模型对页面内容进行中文总结，可选择强制刷新缓存
- 历史记录：按页面签名保存最近分析结果，支持快速回看与重新触发分析
- 灵活配置：内置 OpenAI、Anthropic 预设，支持自定义 API 端点、模型、Token 与温度设置

## 快速开始
1. 克隆或下载本仓库，并确保所有文件保持在同一根目录。
2. 准备一个可用的 LLM API Key（OpenAI、Anthropic 或兼容的自定义服务）。

### 在 Chrome/Chromium 中加载
1. 打开 `chrome://extensions` 并启用开发者模式。
2. 选择“加载已解压的扩展程序”，指向仓库根目录。
3. 每次修改后使用“重新加载”按钮刷新扩展。

### 在 Firefox 中加载
1. 打开 `about:debugging#/runtime/this-firefox`。
2. 点击“加载临时附加组件”，选择仓库根目录下的 `manifest.json`。
3. 代码更新后重复上述步骤重新加载。

## 配置 AI 服务
1. 打开扩展弹窗，切换到“配置”标签页。
2. 在“AI 服务提供商”下拉中选择 `OpenAI`、`Anthropic` 或 `Custom`。
3. 填写 API Endpoint、API Key、模型名称，必要时调整 `Max Tokens` 与 `Temperature`。
4. 使用“测试连接”验证设置，成功后点击“保存配置”。配置持久化在 `chrome.storage.sync` 中，可在多设备间同步。
5. 对于 `Custom` 类型，请确认端点遵循 OpenAI Chat Completions 兼容协议或相同请求结构。

> 默认会校验 API Key 格式（基于提供商的正则约束），如需跳过校验请改用 `Custom` 类型。

## 使用指南
### 表单助手
- 点击“检测表单”获取页面中的输入元素并预览字段信息。
- 配置 AI 后点击“AI 填充表单”生成并写入测试值，扩展会触发 `input` 与 `change` 事件以兼容前端校验。

### 页面分析
- “分析页面”在本地汇总 DOM 数据（标题、正文、链接、图片、语言、词频等）。
- “AI 分析页面”把汇总结果发送给后台服务，请求中文总结，并自动缓存。
- “刷新缓存”会忽略历史记录，强制重新请求并记录来源标签。

### 历史记录
- 弹窗底部展示最近分析的页面，包含标题、时间戳和摘要预览。
- 历史记录基于规范化 URL 与页面签名去重，最多保留 20 条。
- 使用“清除历史”可同时删除本地 (`chrome.storage.local`) 与同步 (`chrome.storage.sync`) 数据。

## 数据与权限
- 权限：`activeTab`、`scripting`、`storage` 用于注入内容脚本和保存配置。
- Host 权限覆盖 `https://*/*` 与 `http://*/*`，以便在任意页面读取内容并调用自定义 AI 端点。
- 配置与历史记录保存在浏览器存储中，不会上传到远程服务器。
- API Key 仅在浏览器内部用于请求你指定的模型服务。

## 开发说明
- 目录结构
  ```
  ├─ background.js          // Service Worker，处理 AI 调用与历史记录
  ├─ content.js             // 内容脚本，提取页面数据与填充表单
  ├─ popup.html / popup.js  // 弹窗界面与交互逻辑
  ├─ modules/
  │  ├─ config-manager.js   // 配置读取、校验与连通性测试
  │  └─ history-manager.js  // 缓存分析结果与页面签名
  └─ icons/                 // 扩展图标资源
  ```
- 提交前可按照以下手动校验流程：
  - 弹窗：验证三个标签页的按钮与状态提示是否符合预期。
  - 内容脚本：在含表单的页面测试字段检测与填充效果。
  - 后台：在 `chrome://extensions` 中打开 Service Worker 日志查看 API 请求结果。
- 修改 manifest 权限或新增模块时，请更新 README 并在 PR 描述中说明理由。

## 故障排查
- “检测表单”无响应：确保目标标签页允许注入内容脚本（例如非 `chrome://` 页面）。
- “AI 填充表单”失败：确认已保存有效配置，且模型端点可访问。
- “AI 分析页面”返回缓存：点击“刷新缓存”或清除历史记录即可强制重试。

欢迎在实际项目中根据需求扩展更多页面解析、权限或 UI 功能。
